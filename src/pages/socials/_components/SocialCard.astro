---
import { Image } from "astro:assets";
import type { TagName } from "./TagBadge.astro";
import TagBadge from "./TagBadge.astro";

interface Props {
    title: string;
    username?: string;
    description?: string;
    href: string;
    linkText: string;
    imageFileName: string;
    imageAlt: string;
    tags: Array<TagName>;
}

const {
    title,
    username,
    description,
    href,
    linkText,
    imageFileName,
    imageAlt,
    tags,
} = Astro.props;

const imagePath = `/src/assets/socials/${imageFileName}`;

const images = import.meta.glob<{ default: ImageMetadata }>(
    "/src/assets/socials/*.{jpeg,jpg,png,gif}"
);
if (!images[imagePath])
    throw new Error(
        `"${imagePath}" does not exist in glob: "src/assets/socials/*.{jpeg,jpg,png,gif}"`
    );
---

<style>
    .social-image {
        transition: filter 0.3s ease;
    }

    :global([data-bs-theme="dark"]) .social-image {
        filter: invert(1) brightness(0.8);
    }

    :global([data-bs-theme="light"]) .social-image {
        filter: none;
    }
</style>

<div class="col-12 col-md-6 col-xl-4" data-tags={tags}>
    <div class="card h-100">
        <div class="row g-0">
            <div class="col-md-4 p-2">
                <div class="d-flex align-items-center h-100">
                    <Image
                        src={images[imagePath]()}
                        class="img-fluid rounded-start social-image"
                        alt={imageAlt}
                        inferSize={true}
                    />
                </div>
            </div>
            <div class="col-md-8">
                <div class="card-body">
                    <h3 class="card-title">{title}</h3>
                    {
                        username && (
                            <h4 class="card-subtitle mb-2 text-muted">
                                {username}
                            </h4>
                        )
                    }
                    {description && <p class="card-text">{description}</p>}
                    <a href={href} class="card-link">{linkText}</a>
                    <div class="mt-3">
                        {tags.map((tag: TagName) => <TagBadge tagName={tag} />)}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
